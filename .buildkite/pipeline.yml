---
#######################################################################################################################################################################################################################
# Executing commands without the anka plugin enabled WILL EXECUTE ON THE HOST MACHINE AND COULD RUIN THEM. Please ensure you've set the chef/anka plugin and tested that it's executing your commands inside of the VM!
#######################################################################################################################################################################################################################
# You can look for problems using yamllint: brew install yamllint
# Artifact storage is available through root::nas tags; mounted NAS located in /Network/NAS

steps:

  - trigger: "mac-anka-fleet"
    label: ":anka: Ensure Anka Template Tag Exists"
    branches: "mac-anka-fleet"
    async: false
    build:
      branch: "master"
      env:
        REPO: "${BUILDKITE_REPO}"
        REPO_BRANCH: "${BUILDKITE_BRANCH}"
        REPO_DIRECTORY: "scripts" # use . for everything
        CHECKSUM: "scripts/eosio_build*"
        TEMPLATE: "10.14.4_6C_16G_30G"
        TEMPLATE_TAG: "root::git-ssh::nas"
        TAG: "${BUILDKITE_PIPELINE_SLUG}"
        TAG_COMMANDS: "./scripts/eosio_build.sh -y"

  - wait

  - label: ":darwin: Testing"
    command:
      - "echo Yep"
    plugins:
    agents:
      - "queue=mac-anka-node-fleet"
    timeout: 60
